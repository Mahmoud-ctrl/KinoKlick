<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results | KinoKlick</title>
    <meta name="referrer" content="origin" />
    <meta name="description" content="Find your favorite movies and TV shows on KinoKlick. Explore the search results for the latest releases, trending titles, and hidden gems." />
    <meta name="keywords" content="search results, movies, TV shows, streaming, KinoKlick, latest releases, trending" />
    <meta name="robots" content="index, follow" />
    <meta name="author" content="KinoKlick" />
    <meta name="theme-color" content="#2C2C2C" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Search Results | KinoKlick">
    <meta property="og:description" content="Find your favorite movies and TV shows on KinoKlick. Explore the search results for the latest releases, trending titles, and hidden gems.">
    <meta property="og:url" content="https://www.kinoklick.com/search">
    <meta property="og:image" content="{{ url_for('static', filename='images/og-image.png') }}">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Search Results | KinoKlick">
    <meta name="twitter:description" content="Find your favorite movies and TV shows on KinoKlick. Explore the search results for the latest releases, trending titles, and hidden gems.">
    <meta name="twitter:image" content="{{ url_for('static', filename='images/twitter-image.png') }}">

    <!-- Styles and Scripts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="icon" href="{{ url_for('static', filename='images/logo-t.png') }}" sizes="48x48" type="image/png">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='search.js') }}"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8739011065764550" crossorigin="anonymous"></script>
</head>


<body>
    <header>
        <div class="logo">
            <a href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='images/logo.webp') }}" alt="KinoKlick Logo">
            </a>
        </div>
        <nav id="desktop-nav">
            <ul>
                <li><a href="{{ url_for('index') }}"><i class="bi bi-house-door"></i> Home</a></li>
                <li><a href="{{ url_for('movies') }}"><i class="bi bi-film"></i> Movies</a></li>
                <li><a href="{{ url_for('tv_shows') }}"><i class="bi bi-tv"></i> TV Shows</a></li>
                <li><a href="{{ url_for('must_watch') }}"><i class="bi bi-star"></i> Must-Watch</a></li>
            </ul>
        </nav>
        <div class="header-right" id="header-right-desktop">
            <form action="{{ url_for('search') }}" method="GET" id="desktop-search">
                <div class="search-container">
                    <input type="text" name="query" class="search__input" placeholder="Search for movies, TV shows..." required autocomplete="off" id="search-input">
                    <button type="submit" class="search__button">
                        <ion-icon name="search"><i class="bi bi-search"></i></ion-icon>
                    </button>
                    <div class="search__suggestions" id="search-suggestions" style="display: none;">
                    </div>
                </div>
            </form>
        </div>


        <div class="mobile-nav">
            <div class="search-toggle" id="search-toggle">
                <i class="fa fa-search"></i>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                &#9776;
            </div>

            <div class="nav-wrapper" id="nav-wrapper">
                <div class="menu-close" id="menu-close">
                    &times;
                </div>
                <nav>
                    <ul>
                        <li><a href="{{ url_for('index') }}"><i class="bi bi-house-door"></i> Home</a></li>
                        <li><a href="{{ url_for('movies') }}"><i class="bi bi-film"></i> Movies</a></li>
                        <li><a href="{{ url_for('tv_shows') }}"><i class="bi bi-tv"></i> TV Shows</a></li>
                        <li><a href="{{ url_for('must_watch') }}"><i class="bi bi-star"></i> Must-Watch</a></li>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="mobile-search-wrapper" id="mobile-search-wrapper" style="display: none;">
            <div class="mobile-search-close" id="mobile-search-close">&times;</div>
            <form action="{{ url_for('search') }}" method="GET" class="mobile-search-form">
                <div class="mobile-search-container">
                    <input type="text" name="query" placeholder="Search for movies, TV shows..." required autocomplete="off" id="mobile-search-input">
                    <button type="submit" class="mobile-search-button">
                        <ion-icon name="search"><i class="bi bi-search"></i></ion-icon>
                    </button>
                </div>
                <ul id="mobile-search-suggestions" style="display: none;"></ul>
            </form>
        </div>
    </header>
    <main>
        <h1>Search Results for "{{ query }}"</h1>
        <section class="movies">
            <h3>Movies</h3>
            <div class="movie-grid" id="movie-grid">
                {% if movie_results %}
                {% for movie in movie_results %}
                <div class="movie-item">
                    <a href="{{ url_for('movie', movie_id=movie[0], title=movie[1].replace(' ', '-').lower()) }}">
                        <img src="{{ movie[7] }}" alt="{{ movie[1] }}">
                        <div class="watch-now-button">Watch Now<i class="bi bi-play"></i></div>
                    </a>
                    <h3>{{ movie[1] }}</h3>
                    <div class="rating-container">
                        <div class="rating">
                            <span class="rating-num"><i class="bi bi-star-fill" style="color: #f8ce0b; padding: 2px;"></i>{{ "%.1f"|format(movie[4]) }}/10 </span>
                        </div>
                    </div>
                    <p>{{ movie[3] | formatDate }}</p>
                </div>
                {% endfor %}
                {% else %}
                <h1>No movies found</h1>
                {% endif %}
            </div>
            {% if movie_results %}
            <button id="load-more-movies" class="load-more" data-offset="10" data-query="{{ query }}">Load More Movies<i class="fa fa-arrow-circle-o-down" style="padding: 5px;"></i></button>
            {% endif %}
    
            <h3>TV Shows</h3>
            <div class="movie-grid" id="tv-show-grid">
                {% if tv_show_results %}
                {% for show in tv_show_results %}
                <div class="movie-item">
                    <a href="{{ url_for('tv_show', series_id=show[0], title=show[1].replace(' ', '-').lower()) }}">
                        <img src="{{ show[5] }}" alt="{{ show[1] }}">
                        <div class="watch-now-button">Watch Now<i class="bi bi-play"></i></div>
                    </a>
                    <h3>{{ show[1] }}</h3>
                    <div class="rating-container">
                        <div class="rating">
                            <span class="rating-num"><i class="bi bi-star-fill" style="color: #f8ce0b; padding: 2px;"></i>{{ "%.1f"|format(show[4]) }}/10 </span>
                        </div>
                    </div>
                    <p>{{ show[3] | formatDate }}</p>
                </div>
                {% endfor %}
                {% else %}
                <h1>No TV shows found</h1>
                {% endif %}
            </div>
            {% if movie_results %}
            <button id="load-more-tv-shows" class="load-more" data-offset="10" data-query="{{ query }}">
                Load More Shows<i class="fa fa-arrow-circle-o-down" style="padding: 5px;"></i>
            </button>
        {% else %}
            <h1>No more results</h1>
        {% endif %}
        
        </section>
    </main>
    
    <script>
   document.getElementById('load-more-movies').addEventListener('click', function() {
    const button = this;
    button.classList.add('loading');
    const offset = parseInt(button.getAttribute('data-offset'));
    const query = button.getAttribute('data-query');
    
    fetch(`/load-more-movies?query=${query}&offset=${offset}`)
        .then(response => response.json())
        .then(data => {
            const movieGrid = document.getElementById('movie-grid');
            const loadMore = document.getElementById('load-more-movies')
            if (data.no_more_results) {
                button.style.display = 'none';  // Hide the button if no more results
                return;
            }
            
            data.movie_results.forEach(movie => {
                const movieItem = `
                    <div class="movie-item">
                        <a href="/movie/${movie.id}-${movie.title.replace('-').toLowerCase()}">
                            <img src="${movie.poster}" alt="${movie.title}">
                        </a>
                        <h3>${movie.title}</h3>
                        <div class="rating-container">
                            <div class="rating">
                                <span class="rating-num"><i class="bi bi-star-fill" style="color: #f8ce0b; padding: 2px;"></i>${(movie.rating).toFixed(1)}/10 </span>
                            </div>
                        </div>
                        <p>${new Date(movie.release_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
                    </div>`;
                movieGrid.insertAdjacentHTML('beforeend', movieItem);
            });
            
            button.setAttribute('data-offset', offset + 10);
            button.classList.remove('loading');
        })
        .catch(error => {
            console.error('Error:', error);
            button.classList.remove('loading');
        });
});

    
document.getElementById('load-more-tv-shows').addEventListener('click', function() {
    const button = this;
    button.classList.add('loading');
    const offset = parseInt(button.getAttribute('data-offset'));
    const query = button.getAttribute('data-query');
    const limit = 10; // Assuming you're loading 10 shows at a time
    
    fetch(`/load-more-tv-shows?query=${query}&offset=${offset}`)
        .then(response => response.json())
        .then(data => {
            const tvShowGrid = document.getElementById('tv-show-grid');
            data.tv_show_results.forEach(show => {
                const showItem = `
                    <div class="movie-item">
                        <a href="/tv-show/${show.id}-${show.title.replace(/ /g, '-').toLowerCase()}">
                            <img src="${show.poster}" alt="${show.title}">
                            <div class="watch-now-button">Watch Now<i class="bi bi-play"></i></div>
                        </a>
                        <h3>${show.title}</h3>
                        <div class="rating-container">
                            <div class="rating">
                                <span class="rating-num"><i class="bi bi-star-fill" style="color: #f8ce0b; padding: 2px;"></i>${(show.rating).toFixed(1)}/10 </span>
                            </div>
                        </div>
                        <p>${new Date(show.release_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
                    </div>`;
                tvShowGrid.insertAdjacentHTML('beforeend', showItem);
            });

            // Update offset
            button.setAttribute('data-offset', offset + limit);

            // If fewer than the limit of TV shows were loaded, hide the button
            if (data.tv_show_results.length < limit) {
                button.style.display = 'none';
            }
            
            button.classList.remove('loading');
        })
        .catch(error => {
            console.error('Error fetching TV shows:', error);
            button.classList.remove('loading');
        });
});
    </script>
    <footer>
        <p>&copy; 2024 KinoKlick. All rights reserved.</p>
    </footer>
</body>

</html>